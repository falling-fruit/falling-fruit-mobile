<!DOCTYPE html>
<html lang="en" ng-app="FallingFruitApp">
  <head>
    <title>Falling Fruit App v1.0</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-touch-fullscreen" content="YES">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=0, maximum-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" type="text/css" href="css/angular-csp.css">
    <link rel="stylesheet" type="text/css" href="css/angular-slider.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
  </head>
  <body>
    <div ng-controller="MainCtrl" class="main-container">
      <div ng-controller="SearchCtrl" class="search-outer-container">
        <div ng-class="{show: show_menu}" class="search-inner-container">
          <div class="search-container">
            <ff-loading-msg></ff-loading-msg>
            <div class="search-menu">
              <div ng-click="update_position()" class="current-location"></div>
              <div class="search-input-container">
                <form ng-submit="location_search()">
                  <input type="submit" value="">
                  <input type="text" placeholder="Enter a location..." ng-model="search_text">
                </form>
              </div>
            </div>
            <div class="search-view-container">
              <div directionstype="directions_type" stoplist="stopList" class="map-container">
                <div ng-class="{add: add_location}" class="crosshair"></div>
              </div>
              <div ng-class="current_view == 'list' ? 'show' : ''" class="list-container"><a ng-repeat="li in list_items track by li.location_id" ng-click="show_detail(li.location_id)" class="list-item">
                  <div ng-style="li.style" class="list-item-image"></div>
                  <div class="list-item-info-container">
                    <div class="list-item-distance">[{li.distance_string}]</div>
                    <div class="list-item-name">[{::li.title}]</div>
                    <div class="list-item-description">[{::li.description}]</div>
                  </div></a></div>
            </div>
            <div class="search-footer">
              <div ng-click="show_menu = !show_menu" class="settings controls"></div>
              <div class="btn-group-container">
                <div class="btn-group">
                  <div ng-class="current_view == 'map' ? 'active' : ''" ng-click="show_map()" class="btn-map">Map</div>
                  <div ng-class="current_view == 'list' ? 'active' : ''" ng-click="show_list()" class="btn-list">List</div>
                </div>
              </div>
              <div ng-click="begin_add_location()" class="add-location controls"></div>
              <div ng-class="{show: add_location}" class="add-location-controls">
                <div ng-click="cancel_add_location()" class="cancel-add-location controls"></div>
                <div ng-click="show_detail()" class="confirm-add-location controls"></div>
              </div>
            </div>
          </div>
          <div ng-controller="MenuCtrl" class="search-side-menu-container">
            <div class="search-side-menu">
              <div class="search-params-container">
                <div class="search-param-header">Map</div><a ng-click="toggle_terrain()" class="search-param-radio">Terrain
                  <div class="search-radio-container">
                    <div ng-show="mapTypeId == 'terrain'" class="search-radio-active"></div>
                  </div></a><a ng-click="toggle_hybrid()" class="search-param-radio">Satellite
                  <div class="search-radio-container">
                    <div ng-show="mapTypeId == 'hybrid'" class="search-radio-active"></div>
                  </div></a><a ng-click="toggle_bicycle()" class="search-param-radio">Bicycle
                  <div class="search-radio-container">
                    <div ng-show="layer == 'bicycle'" class="search-radio-active"></div>
                  </div></a><a ng-click="toggle_transit()" class="search-param-radio">Transit
                  <div class="search-radio-container">
                    <div ng-show="layer == 'transit'" class="search-radio-active"></div>
                  </div></a>
                <div class="search-param-header">Filters</div><a ng-click="toggle_muni()" class="search-param-radio">Tree inventories
                  <div class="search-radio-container">
                    <div ng-show="muni" class="search-radio-active"></div>
                  </div></a>
                <div class="search-param-header">Regional</div><a ng-click="toggle_metric()" class="search-param-radio">Metric units
                  <div class="search-radio-container">
                    <div ng-show="metric" class="search-radio-active"></div>
                  </div></a>
              </div><a ng-click="logout()" class="btn-logout-container">
                <div class="btn-logout">Sign out</div></a>
            </div>
          </div>
        </div>
      </div>
      <div ng-controller="DetailCtrl" ng-class="show_detail == true? 'show': ''" class="detail-outer-container">
        <ff-loading-msg></ff-loading-msg>
        <div class="menu">
          <div ng-click="menu_left_btn_click()" class="menu-left-btn back"></div>
          <div class="menu-title">[{menu_title}]</div>
          <div class="menu-right-btn"></div>
        </div>
        <div ng-show="detail_context=='view_location'" class="detail-container">
          <!-- Photos-->
          <div ng-show="location.photos.length &gt; 0" class="photo-list-container">
            <ul class="photo-list">
              <li ng-repeat="photo in location.photos"><img ng-src="[{photo.url}]"></li>
            </ul>
          </div>
          <!-- Details-->
          <div class="location-info">
            <div class="location-types"><span ng-repeat="id in location.type_ids">[{source_types_by_id[id].name}][{$last ? '' : ', '}]</span></div>
            <div ng-show="location.current_distance == location.map_distance">[{location.current_distance}]</div>
            <div ng-show="location.current_distance != location.map_distance"><span ng-show="location.current_distance">[{location.current_distance}] (from me) &nbsp;/ &nbsp;</span><span>[{location.map_distance}] (from map center)</span></div>
            <div class="tag-list">
              <div ng-show="location.season_string" class="tag">
                <div class="label">Season</div>&nbsp; [{location.season_string}]
              </div>
              <div ng-show="location.access != null" class="tag">
                <div class="label">[{location.access_string}]</div>
              </div>
              <div ng-show="location.unverified" class="tag">
                <div class="label">Unverified</div>
              </div>
            </div>
          </div>
          <!-- Description-->
          <div class="location-description">[{location.description}]</div>
          <div class="location-author">
            <div>Added [{location.created_at | date : 'MMMM d, yyyy'}] by [{location.author}]</div>
            <div ng-show="location.updated_at.toDateString() != location.created_at.toDateString()">Updated [{location.updated_at | date : 'MMMM d, yyyy'}]</div>
          </div>
          <!-- Buttons-->
          <div class="detail-btn-container">
            <div ng-click="detail_context='add_location'; menu_title='Edit location';" class="detail-btn-dark">Edit</div>
            <div ng-click="add_review(location.id)" class="detail-btn-dark">Review</div>
          </div>
          <div class="detail-btn-container">
            <div ng-click="show_reviews()" ng-show="location.num_reviews &gt; 0" class="detail-btn-dark">Read reviews ([{location.num_reviews}])</div>
          </div>
        </div>
        <div ng-show="detail_context=='add_location'" class="detail-container">
          <div class="detail-select-container">[{location.type_ids == undefined ? "Source type" : source_types_by_id[location.type_ids[0]].name}]
            <select ng-model="location.type_ids[0]" ng-options="type.id as type.name for type in source_types"></select>
          </div>
          <!--.detail-input-container-->
          <!--  input(type="text", placeholder="?", ng-model="location.lat")-->
          <!--.detail-input-container-->
          <!--  input(type="text", placeholder="?", ng-model="location.lng")-->
          <div class="detail-textarea-container location">
            <textarea placeholder="Description..." ng-model="location.description"></textarea>
          </div>
          <div class="detail-select-container">[{location.access == undefined ? "Access" : short_access_types[location.access]}]
            <select ng-model="location.access" ng-options="i as access for (i,access) in short_access_types"></select>
          </div>
          <div class="detail-toggle-container">
            <div class="detail-toggle-label">Unverified</div>
            <div toggle="location.unverified" class="ng-switcher"></div>
          </div>
          <div class="detail-range-container">
            <div class="detail-range-label-1">Quality</div>
            <div class="detail-range-label-2">[{ratings[location.observation.quality_rating]}]</div>
            <div class="detail-range-control">
              <input type="range" ng-model="location.observation.quality_rating" min="0" max="5" step="1">
            </div>
          </div>
          <div class="detail-range-container">
            <div class="detail-range-label-1">Yield</div>
            <div class="detail-range-label-2">[{ratings[location.observation.yield_rating]}]</div>
            <div class="detail-range-control">
              <input type="range" ng-model="location.observation.yield_rating" min="0" max="5" step="1">
            </div>
          </div>
          <div class="detail-range-container">
            <div class="detail-range-label-1">Ripeness</div>
            <div class="detail-range-label-2">[{fruiting_status[location.observation.fruiting]}]</div>
            <div class="detail-range-control">
              <input type="range" ng-model="location.observation.fruiting" min="0" max="4" step="1">
            </div>
          </div>
          <div class="detail-btn btn-photo">Take a photo
            <input type="file" capture="camera" accept="image/*" onchange="angular.element(this).scope().update_photo_list(this.files)">
          </div>
          <div ng-click="save_location()" class="detail-btn-dark btn-save">Save</div>
        </div>
        <div ng-show="detail_context=='view_reviews'" class="detail-container">
          <div class="review-list-container">
            <!-- FIXME: Once supported by API, enable users to edit their own reviews?-->
            <!-- a.list-item(ng-repeat="r in reviews", ng-click="add_review(r.id)")--><a ng-repeat="r in reviews" class="list-item">
              <div ng-style="r.style" class="list-item-image"></div>
              <div class="list-item-info-container">
                <div class="review-author">by [{::r.author? r.author : "Anonymous"}]</div>
                <div><span ng-show="r.observed_on">Visited [{::r.observed_on | date : 'MMMM d, yyyy'}]</span><span ng-show="!r.observed_on">Posted [{::r.created_at | date : 'MMMM d, yyyy'}]</span></div>
                <div class="tag-list"><span ng-show="r.fruiting != null" class="tag"><span class="label">Status&nbsp;</span>[{::fruiting_status[r.fruiting]}]</span><span ng-show="r.quality_rating != null" class="tag"><span class="label">Quality&nbsp;</span>[{::ratings[r.quality_rating]}]</span><span ng-show="r.yield_rating != null" class="tag"><span class="label">Yield&nbsp;</span>[{::ratings[r.yield_rating]}]</span></div>
                <div ng-show="r.comment">[{::r.comment}]</div>
              </div></a>
            <div class="detail-btn-container">
              <div ng-click="add_review(location.id)" class="detail-btn-dark">Add a review</div>
            </div>
          </div>
        </div>
        <div ng-show="detail_context=='add_review'" class="detail-container">
          <div class="detail-textarea-container">
            <textarea ng-model="location.observation.comment" placeholder="Add a comment..."></textarea>
          </div>
          <div class="detail-range-container">
            <div class="detail-range-label-1">Quality</div>
            <div class="detail-range-label-2">[{ratings[location.observation.quality_rating]}]</div>
            <div class="detail-range-control">
              <input type="range" ng-model="location.observation.quality_rating" min="0" max="5" step="1">
            </div>
          </div>
          <div class="detail-range-container">
            <div class="detail-range-label-1">Yield</div>
            <div class="detail-range-label-2">[{ratings[location.observation.yield_rating]}]</div>
            <div class="detail-range-control">
              <input type="range" ng-model="location.observation.yield_rating" min="0" max="5" step="1">
            </div>
          </div>
          <div class="detail-range-container">
            <div class="detail-range-label-1">Ripeness</div>
            <div class="detail-range-label-2">[{fruiting_status[location.observation.fruiting]}]</div>
            <div class="detail-range-control">
              <input type="range" ng-model="location.observation.fruiting" min="0" max="4" step="1">
            </div>
          </div>
          <div class="detail-btn btn-photo">Take a photo
            <input type="file" capture="camera" accept="image/*" onchange="angular.element(this).scope().update_photo_list(this.files)" id="photo_button">
          </div>
          <div class="detail-textarea-container">
            <textarea ng-model="location.observation.photo_caption" placeholder="Add a caption..."></textarea>
          </div>
          <div ng-click="save_review()" class="detail-btn-dark btn-save">Save</div>
        </div>
      </div>
      <div ng-controller="AuthCtrl" ng-class="show_auth == true ? 'show': ''" class="auth-overlay">
        <div ng-show="auth_context == 'login'" class="auth-container login">
          <div class="auth-login-logo"></div>
          <div class="auth-input-container email">
            <input type="text" placeholder="Email" ng-model="login_user.email">
            <div class="auth-error-text"></div>
          </div>
          <div class="auth-input-container password">
            <input type="password" placeholder="Password" ng-model="login_user.password">
            <div class="auth-error-text"></div>
          </div><a ng-click="auth_context='forgot_password'" class="auth-text">Forgot password?</a>
          <div class="auth-btn-container"><a ng-click="login()" class="auth-btn-cell">Sign in</a><a ng-click="auth_context = 'register'" class="auth-btn-cell">Register</a></div>
        </div>
        <div ng-show="auth_context == 'register'" class="auth-container register">
          <div class="auth-default-logo"></div>
          <div class="auth-input-container name">
            <input type="text" placeholder="Name" ng-model="register_user.name">
            <div class="auth-error-text"></div>
          </div>
          <div class="auth-input-container email">
            <input type="text" placeholder="Email" ng-model="register_user.email">
            <div class="auth-error-text"></div>
          </div>
          <div class="auth-input-container password-1">
            <input type="password" placeholder="Password" ng-model="register_user.password">
            <div class="auth-error-text"></div>
          </div>
          <div class="auth-input-container password-2">
            <input type="password" placeholder="Confirm password" ng-model="register_user.password_confirmation">
            <div class="auth-error-text"></div>
          </div><a ng-click="register()" class="auth-btn">Send confirmation</a><a ng-click="auth_context = 'login'" class="auth-btn-dark">Login</a>
        </div>
        <div ng-show="auth_context == 'forgot_password'" class="auth-container forgot-password">
          <div class="auth-default-logo"></div>
          <div class="auth-input-container email">
            <input type="text" placeholder="Email">
            <div class="auth-error-text"></div>
          </div><a ng-click="forgot_password()" class="auth-btn">Send reset instructions</a><a ng-click="auth_context = 'login'" class="auth-btn-dark">Login</a>
        </div>
      </div>
    </div>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/lib/lodash.min.js"></script>
    <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDm7gTRTOlOIsum_KOwfM-X13RYexMW41M&amp;libraries=geometry"></script>
    <script type="text/javascript" src="js/lib/angular.js"></script>
    <script type="text/javascript" src="js/lib/angular-route.js"></script>
    <script type="text/javascript" src="js/lib/angular-touch.js"></script>
    <script type="text/javascript" src="js/lib/angular-animate.js"></script>
    <script type="text/javascript" src="js/lib/angular-slider.js"></script>
    <script type="text/javascript" src="js/all.js"></script>
  </body>
</html>