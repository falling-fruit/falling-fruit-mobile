
<div ng-controller="DetailCtrl" ng-class="show_detail == true? 'show': ''" class="detail-outer-container">
  <div class="menu">
    <div ng-click="menu_left_btn_click()" class="menu-left-btn back"></div>
    <div class="menu-title">[{menu_title}]</div>
    <div class="menu-right-btn"></div>
  </div>
  <div ng-show="detail_context=='view_location'" class="detail-container">
    <div class="photo-list-container">
      <ul class="photo-list">
        <li ng-repeat="photo in location.photos"></li>
      </ul>
    </div>
    <div class="location-info">
      <div class="location-types"><span ng-repeat="id in location.type_ids">[{source_types_by_id[id].name}][{$last ? '' : ', '}]</span></div>
      <div>Lat, Lng: [{location.lat}], [{location.lng}]</div>
      <div ng-show="location.map_distance">Distance (map): [{location.map_distance}]</div>
      <div ng-show="location.current_distance">Distance (me): [{location.current_distance}]</div>
      <div ng-show="location.season_string">Season: [{location.season_string}]</div>
      <div>Added: [{location.created_at | date : 'MMMM d, yyyy'}]</div>
      <div>Updated: [{location.updated_at | date : 'MMMM d, yyyy'}]</div>
      <div ng-show="location.access != null">Access: [{location.access_string}]</div>
      <div>Unverified: [{location.unverified}]</div>
    </div>
    <div class="location-description">[{location.description}]</div>
    <div class="location-author">added by [{location.author}]</div>
    <div class="detail-btn-container">
      <div ng-click="detail_context='add_location'; menu_title='Edit';" class="detail-btn-dark">Edit</div>
      <div ng-click="add_review(location.id)" class="detail-btn-dark">Review</div>
    </div>
    <div class="detail-btn-container">
      <div ng-click="show_reviews()" ng-show="location.num_reviews &gt; 0" class="detail-btn-dark">Read reviews ([{location.num_reviews}])</div>
    </div>
  </div>
  <div ng-show="detail_context=='add_location'" class="detail-container"> 
    <div class="detail-select-container">[{location.type_ids == undefined ? "Source type" : source_types_by_id[location.type_ids[0]].name}]
      <select ng-model="location.type_ids[0]" ng-options="type.id as type.name for type in source_types"></select>
    </div>
    <!--.detail-input-container-->
    <!--  input(type="text", placeholder="?", ng-model="location.lat")-->
    <!--.detail-input-container-->
    <!--  input(type="text", placeholder="?", ng-model="location.lng")                -->
    <div class="detail-textarea-container location">
      <textarea placeholder="Description..." ng-model="location.description"></textarea>
    </div>
    <div class="detail-select-container">[{location.access == undefined ? "Access" : short_access_types[location.access]}]
      <select ng-model="location.access" ng-options="i as access for (i,access) in short_access_types"></select>
    </div>
    <div class="detail-toggle-container">
      <div class="detail-toggle-label">Unverified</div>
      <div toggle="location.unverified" class="ng-switcher"></div>
    </div>
    <div class="detail-range-container">
      <div class="detail-range-label-1">Quality </div>
      <div class="detail-range-label-2">[{ratings[location.observation.quality_rating]}]</div>
      <div class="detail-range-control">
        <input type="range" ng-model="location.observation.quality_rating" min="0" max="4" step="1" value="0"/>
      </div>
    </div>
    <div class="detail-range-container">
      <div class="detail-range-label-1">Yield</div>
      <div class="detail-range-label-2">[{ratings[location.observation.yield_rating]}]</div>
      <div class="detail-range-control">
        <input type="range" ng-model="location.observation.yield_rating" min="0" max="4" step="1" value="0"/>
      </div>
    </div>
    <div class="detail-range-container">
      <div class="detail-range-label-1">Ripeness </div>
      <div class="detail-range-label-2">[{fruiting_status[location.observation.fruiting]}]</div>
      <div class="detail-range-control">
        <input type="range" ng-model="location.observation.fruiting" min="0" max="3" step="1" value="0"/>
      </div>
    </div>
    <div class="detail-btn btn-photo">Take a photo
      <input type="file" capture="camera" accept="image/*" onchange="angular.element(this).scope().update_photo_list(this.files)"/>
    </div>
    <div ng-click="save_location()" class="detail-btn-dark btn-save">Save</div>
  </div>
  <div ng-show="detail_context=='view_reviews'" class="detail-container">
    <div class="review-list-container">
      <!-- FIXME: Once supported by API, enable users to edit their own reviews?-->
      <!-- a.list-item(ng-repeat="r in reviews", ng-click="add_review(r.id)")--><a ng-repeat="r in reviews" class="list-item">
        <div ng-style="r.style" class="list-item-image"></div>
        <div class="list-item-info-container">
          <div class="review-author">by [{::r.author? r.author : "Anonymous"}]</div>
          <div>Visited [{::r.observed_on | date : 'MMMM d, yyyy'}]</div>
          <div class="review-tag-list"><span ng-show="r.fruiting != null" class="tag"><span class="label">Status&nbsp;</span>[{::fruiting_status[r.fruiting]}]</span><span ng-show="r.quality_rating != null" class="tag"><span class="label">Quality&nbsp;</span>[{::ratings[r.quality_rating]}]</span><span ng-show="r.yield_rating != null" class="tag"><span class="label">Yield&nbsp;</span>[{::ratings[r.yield_rating]}]</span></div>
          <div ng-show="r.comment">[{::r.comment}]</div>
        </div></a>
      <div class="detail-btn-container">
        <div ng-click="add_review(location.id)" class="detail-btn-dark">Add a review</div>
      </div>
    </div>
  </div>
  <div ng-show="detail_context=='add_review'" class="detail-container">
    <div class="detail-textarea-container">
      <textarea ng-model="location.observation.comment" placeholder="Add a comment..."></textarea>
    </div>
    <div class="detail-range-container">
      <div class="detail-range-label-1">Quality </div>
      <div class="detail-range-label-2">[{ratings[location.observation.quality_rating]}]</div>
      <div class="detail-range-control">
        <input type="range" ng-model="location.observation.quality_rating" min="0" max="4" step="1" value="0"/>
      </div>
    </div>
    <div class="detail-range-container">
      <div class="detail-range-label-1">Yield</div>
      <div class="detail-range-label-2">[{ratings[location.observation.yield_rating]}]</div>
      <div class="detail-range-control">
        <input type="range" ng-model="location.observation.yield_rating" min="0" max="4" step="1" value="0"/>
      </div>
    </div>
    <div class="detail-range-container">
      <div class="detail-range-label-1">Ripeness</div>
      <div class="detail-range-label-2">[{fruiting_status[location.observation.fruiting]}]</div>
      <div class="detail-range-control">
        <input type="range" ng-model="location.observation.fruiting" min="0" max="3" step="1" value="0"/>
      </div>
    </div>
    <div class="detail-btn btn-photo">Take a photo
      <input type="file" capture="camera" accept="image/*" onchange="angular.element(this).scope().update_photo_list(this.files)" id="photo_button"/>
    </div>
    <div class="detail-textarea-container">
      <textarea ng-model="location.observation.photo_caption" placeholder="Add a caption..."></textarea>
    </div>
    <div ng-click="save_review()" class="detail-btn-dark btn-save">Save</div>
  </div>
</div>